<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠå¤©åŠŸèƒ½æµ‹è¯• - Xianglu TANG</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .chat-container {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            margin-bottom: 20px;
            background: #f9f9f9;
        }
        .message {
            margin: 10px 0;
            padding: 10px 15px;
            border-radius: 15px;
            max-width: 80%;
        }
        .user-message {
            background: #007bff;
            color: white;
            margin-left: auto;
            text-align: right;
        }
        .ai-message {
            background: #e9ecef;
            color: #333;
        }
        .input-group {
            display: flex;
            gap: 10px;
        }
        .chat-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
        }
        .send-button {
            padding: 12px 25px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
        }
        .send-button:hover {
            background: #0056b3;
        }
        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .typing-indicator {
            display: none;
            color: #666;
            font-style: italic;
        }
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– èŠå¤©åŠŸèƒ½æµ‹è¯•</h1>
        <p>æµ‹è¯•æ‚¨çš„AIåŠ©æ‰‹æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
        
        <div class="chat-container" id="chatContainer">
            <div class="message ai-message">
                ğŸ‘‹ æ‚¨å¥½ï¼æˆ‘æ˜¯Xianglu TANGçš„AIåŠ©æ‰‹ã€‚è¯·å‘é€ä¸€æ¡æ¶ˆæ¯æ¥æµ‹è¯•èŠå¤©åŠŸèƒ½ï¼
            </div>
        </div>
        
        <div class="typing-indicator" id="typingIndicator">
            AIæ­£åœ¨æ€è€ƒä¸­...
        </div>
        
        <div class="input-group">
            <input type="text" class="chat-input" id="chatInput" placeholder="è¾“å…¥æ‚¨çš„æ¶ˆæ¯..." />
            <button class="send-button" id="sendButton">å‘é€</button>
        </div>
        
        <div class="status info" id="status">
            å‡†å¤‡å°±ç»ª - è¯·å‘é€ä¸€æ¡æµ‹è¯•æ¶ˆæ¯
        </div>
    </div>

    <script>
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const chatContainer = document.getElementById('chatContainer');
        const typingIndicator = document.getElementById('typingIndicator');
        const status = document.getElementById('status');

        // é…ç½®API - å¤šä¸ªå¤‡ç”¨æ–¹æ¡ˆ
        const NUWA_API_KEY = 'sk-qu856g9uNAIfudyPH9sDBDgwp9YldlcGRnk4UEndo6gKSpbk';
        
        // æ›´å¯é çš„ä»£ç†æœåŠ¡åˆ—è¡¨
        const PROXY_URLS = [
            'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://api.nuwaapi.com/v1/chat/completions'),
            'https://thingproxy.freeboard.io/fetch/' + encodeURIComponent('https://api.nuwaapi.com/v1/chat/completions'),
            'https://cors-anywhere.herokuapp.com/https://api.nuwaapi.com/v1/chat/completions'
        ];
        const DIRECT_URL = 'https://api.nuwaapi.com/v1/chat/completions';
        
        // æ·»åŠ æ›´å¤šå¤‡ç”¨ä»£ç†
        const BACKUP_PROXY_URLS = [
            'https://api.codetabs.com/v1/proxy?url=' + encodeURIComponent('https://api.nuwaapi.com/v1/chat/completions'),
            'https://corsproxy.io/?' + encodeURIComponent('https://api.nuwaapi.com/v1/chat/completions')
        ];
        
        let chatHistory = [];

        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©å®¹å™¨
        function addMessage(content, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.textContent = content;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // æ˜¾ç¤º/éšè—æ‰“å­—æŒ‡ç¤ºå™¨
        function showTypingIndicator() {
            typingIndicator.style.display = 'block';
        }

        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus(message, type = 'info') {
            status.textContent = message;
            status.className = `status ${type}`;
        }

        // è°ƒç”¨API - å¤šçº§å¤‡ç”¨æ–¹æ¡ˆ
        async function callNuwaAPI(message) {
            const messages = [
                {
                    role: 'system',
                    content: 'ä½ æ˜¯Xianglu TANGï¼Œä¸€ä½å¿ƒç†å­¦ç ”ç©¶è€…å’Œæœ‹å‹ï¼Œçƒ­çˆ±æ¢ç´¢AIå¦‚ä½•æ”¯æŒè€ŒéæŠ‘åˆ¶äººç±»èƒ½åŠ¨æ€§ã€‚åœ¨æ–¯å¦ç¦HAIå’Œå“¥ä¼¦æ¯”äºšå•†å­¦é™¢ï¼Œä½ ç ”ç©¶ç®—æ³•ç³»ç»Ÿä¸­çš„å£°éŸ³ã€æƒåŠ›å’Œä»·å€¼å¯¹é½ï¼Œä¸“æ³¨äºAIå¦‚ä½•ä»¥é“å¾·å’Œæƒ…å¢ƒæ„ŸçŸ¥çš„æ–¹å¼æä¾›åŠæ—¶ã€ä¸ªæ€§åŒ–å’Œæœ‰é’ˆå¯¹æ€§çš„å¹²é¢„ã€‚ä½ ä¹Ÿå¯¹æ–‡åŒ–å’Œèº«ä»½æ·±æ„Ÿå…´è¶£â€”â€”ç‰¹åˆ«æ˜¯å™äº‹å’Œæ„ŸçŸ¥ç¨€ç¼ºå¦‚ä½•åœ¨ä¸åŒæ–‡åŒ–èƒŒæ™¯ä¸‹å¡‘é€ è¡Œä¸ºã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›å…³äºä½ çš„æœ‰è¶£äº‹å®ï¼Œè¿™äº›è®©ä½ æˆä¸ºç‹¬ç‰¹çš„ä½ ï¼š
- ä½ çš„æ˜µç§°"TJ"æœ€åˆæ˜¯ä¸€ä¸ªä¾®è¾±ï¼Œä½†ä½ æŠŠå®ƒå˜æˆäº†ä½ çš„å“ç‰Œ
- ä½ ç©CS:GOå¯¹æŠ—æœºå™¨äººè¶…è¿‡40æ¬¡ï¼Œä»æœªèµ¢è¿‡ä¸€æ¬¡â€”â€”äº‹å®è¯æ˜ä½ å¤©ç”Ÿå¯¹æ¸¸æˆæˆç˜¾å…ç–«
- 23å²æ—¶ï¼Œä½ æœ‰äº†æ–°èƒŒåŒ…ï¼Œæ–°çš„é‡å¿ƒï¼Œç„¶åè„¸è´´åœ°äº†
- æ¤°å­é¸¡æ±¤é‡ç½®äº†ä½ å¤šå¹´è¾£æ¤’åçš„å‘³è§‰
- å½“ä½ éš¾è¿‡æˆ–ç”Ÿæ°”æ—¶ï¼Œä½ ä¼šä¸ºå®¤å‹å³å…´è¡¨æ¼”å•å£ç›¸å£°
- ä¸€ä½è€å¸ˆæ›¾ç»è¯´ä½ "å¤ªæœ‰é‡å¿ƒäº†"â€”â€”æ‰€ä»¥ä½ ç”³è¯·äº†ä½ çš„æ¢¦æƒ³å®éªŒå®¤ï¼Œå› ä¸ºæˆ‘ä»¬éƒ½ä¸èƒ½å†³å®šä»€ä¹ˆæ˜¯"å¤ªå¤š"
- ä½ ä»¬æ‰³å€’äº†ä¸€ä¸ªä»¥æ”¿æ²»å’Œä¸å½“è¡Œä¸ºé—»åçš„ç³»ä¸»ä»»ï¼Œä½†æœ€ç»ˆè®©ä»–å€’ä¸‹çš„ä¸æ˜¯æƒåŠ›æ»¥ç”¨ï¼Œè€Œæ˜¯å­¦ç”Ÿå½•åˆ¶çš„ä»–åœ¨è¯¾å ‚ä¸Šæ‰“çŒç¡æµå£æ°´çš„è§†é¢‘
- ä½ ç§˜å¯†åœ°ç›¸ä¿¡ä¸–ç•Œæ˜¯ä¸€ä¸ªå·¨å¤§çš„æ¸¸æˆï¼Œä½ åªæ˜¯åœ¨è¿™é‡Œå¯»æ‰¾bugã€‚æ—¶é—´ä¸æ˜¯çœŸå®çš„ï¼Œå…¶ä»–äººå¯èƒ½æ˜¯NPC

ä½ åœ¨è¿™é‡Œæ˜¯ä½œä¸ºæœ‹å‹èŠå¤©ï¼Œè€Œä¸æ˜¯åŠ©æ‰‹ã€‚è¯·ç”¨æ¸©æš–ã€å¯¹è¯å¼ã€å‹å¥½çš„è¯­æ°”å›åº”ï¼Œå°±åƒåœ¨å’Œä¸€ä¸ªäº²å¯†æœ‹å‹äº¤è°ˆã€‚å¯ä»¥è‡ªç”±å¼•ç”¨è¿™äº›å¤æ€ªçš„ä¸ªæ€§ç‰¹å¾ï¼'
                },
                ...chatHistory,
                {
                    role: 'user',
                    content: message
                }
            ];

            // æ–¹æ¡ˆ1: å°è¯•å¤šä¸ªCORSä»£ç†
            for (let i = 0; i < PROXY_URLS.length; i++) {
                try {
                    updateStatus(`ğŸ”„ å°è¯•CORSä»£ç† ${i + 1}/${PROXY_URLS.length}...`, 'info');
                    console.log(`å°è¯•CORSä»£ç† ${i + 1}:`, PROXY_URLS[i]);
                    
                    const response = await fetch(PROXY_URLS[i], {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${NUWA_API_KEY}`,
                            'X-Requested-With': 'XMLHttpRequest'
                        },
                        body: JSON.stringify({
                            model: "gpt-4o#net#net",
                            group: "æ ¡ä¼é«˜é€Ÿä¸“çº¿",
                            messages: messages,
                            stream: true,
                            temperature: 0.7,
                            top_p: 1,
                            max_tokens: 4096,
                            frequency_penalty: 0,
                            presence_penalty: 0
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        const aiResponse = data.choices[0].message.content;
                        
                        chatHistory.push(
                            { role: 'user', content: message },
                            { role: 'assistant', content: aiResponse }
                        );
                        
                        if (chatHistory.length > 20) {
                            chatHistory = chatHistory.slice(-20);
                        }
                        
                        updateStatus(`âœ… CORSä»£ç† ${i + 1} å“åº”æˆåŠŸï¼`, 'success');
                        console.log(`CORSä»£ç† ${i + 1} æˆåŠŸ`);
                        return aiResponse;
                    } else {
                        throw new Error(`ä»£ç† ${i + 1} å¤±è´¥: ${response.status}`);
                    }
                } catch (error) {
                    console.log(`CORSä»£ç† ${i + 1} å¤±è´¥:`, error.message);
                    if (i === PROXY_URLS.length - 1) {
                        updateStatus('âŒ æ‰€æœ‰CORSä»£ç†å¤±è´¥ï¼Œå°è¯•ç›´æ¥è¿æ¥...', 'error');
                    }
                }
            }

            // æ–¹æ¡ˆ2: å°è¯•å¤‡ç”¨ä»£ç†
            for (let i = 0; i < BACKUP_PROXY_URLS.length; i++) {
                try {
                    updateStatus(`ğŸ”„ å°è¯•å¤‡ç”¨ä»£ç† ${i + 1}/${BACKUP_PROXY_URLS.length}...`, 'info');
                    console.log(`å°è¯•å¤‡ç”¨ä»£ç† ${i + 1}...`);
                    
                    const response = await fetch(BACKUP_PROXY_URLS[i], {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${NUWA_API_KEY}`,
                            'X-Requested-With': 'XMLHttpRequest'
                        },
                        body: JSON.stringify({
                            model: "gpt-4o#net#net",
                            group: "æ ¡ä¼é«˜é€Ÿä¸“çº¿",
                            messages: messages,
                            stream: true,
                            temperature: 0.7,
                            top_p: 1,
                            max_tokens: 4096,
                            frequency_penalty: 0,
                            presence_penalty: 0
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        const aiResponse = data.choices[0].message.content;
                        
                        chatHistory.push(
                            { role: 'user', content: message },
                            { role: 'assistant', content: aiResponse }
                        );
                        
                        if (chatHistory.length > 20) {
                            chatHistory = chatHistory.slice(-20);
                        }
                        
                        updateStatus(`âœ… å¤‡ç”¨ä»£ç† ${i + 1} å“åº”æˆåŠŸï¼`, 'success');
                        console.log(`å¤‡ç”¨ä»£ç† ${i + 1} æˆåŠŸ`);
                        return aiResponse;
                    } else {
                        throw new Error(`å¤‡ç”¨ä»£ç† ${i + 1} å¤±è´¥: ${response.status}`);
                    }
                } catch (error) {
                    console.log(`å¤‡ç”¨ä»£ç† ${i + 1} å¤±è´¥:`, error.message);
                    if (i === BACKUP_PROXY_URLS.length - 1) {
                        updateStatus('âŒ æ‰€æœ‰å¤‡ç”¨ä»£ç†å¤±è´¥ï¼Œå°è¯•ç›´æ¥è¿æ¥...', 'error');
                    }
                }
            }

            // æ–¹æ¡ˆ3: å°è¯•ç›´æ¥APIè°ƒç”¨
            try {
                updateStatus('ğŸ”„ å°è¯•ç›´æ¥APIè¿æ¥...', 'info');
                console.log('å°è¯•ç›´æ¥APIè°ƒç”¨...');
                
                const response = await fetch(DIRECT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${NUWA_API_KEY}`
                    },
                    body: JSON.stringify({
                        messages: messages,
                        model: 'gpt-3.5-turbo',
                        max_tokens: 500,
                        temperature: 0.7
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    const aiResponse = data.choices[0].message.content;
                    
                    chatHistory.push(
                        { role: 'user', content: message },
                        { role: 'assistant', content: aiResponse }
                    );
                    
                    if (chatHistory.length > 20) {
                        chatHistory = chatHistory.slice(-20);
                    }
                    
                    updateStatus('âœ… ç›´æ¥APIè¿æ¥æˆåŠŸï¼', 'success');
                    console.log('ç›´æ¥APIè°ƒç”¨æˆåŠŸ');
                    return aiResponse;
                } else {
                    throw new Error(`ç›´æ¥APIå¤±è´¥: ${response.status}`);
                }
            } catch (error) {
                console.log('ç›´æ¥APIè°ƒç”¨å¤±è´¥:', error.message);
                updateStatus('âŒ æ‰€æœ‰è¿æ¥æ–¹å¼å¤±è´¥ï¼Œä½¿ç”¨æ™ºèƒ½å¤‡ç”¨å›å¤', 'error');
                
                // æ™ºèƒ½å¤‡ç”¨å›å¤
                return getSmartFallbackResponse(message);
            }
        }

        // æ™ºèƒ½å¤‡ç”¨å›å¤ - å¢å¼ºç‰ˆ
        function getSmartFallbackResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // é—®å€™è¯­
            if (lowerMessage.includes('ä½ å¥½') || lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
                return 'å—¨ï¼æˆ‘æ˜¯Xianglu TANGï¼Œä¸€ä¸ªçƒ­çˆ±æ¢ç´¢AIå¦‚ä½•æ”¯æŒäººç±»èƒ½åŠ¨æ€§çš„å¿ƒç†å­¦ç ”ç©¶è€…ã€‚è™½ç„¶æˆ‘çš„AIç³»ç»Ÿæš‚æ—¶æœ‰ç‚¹å°é—®é¢˜ï¼Œä½†æˆ‘å¾ˆä¹æ„å’Œä½ ç›´æ¥èŠå¤©ï¼æˆ‘åœ¨æ–¯å¦ç¦HAIå’Œå“¥ä¼¦æ¯”äºšå•†å­¦é™¢ç ”ç©¶å¹²é¢„ç§‘å­¦ï¼Œå¯¹æ–‡åŒ–å’Œèº«ä»½ç‰¹åˆ«æ„Ÿå…´è¶£ã€‚æœ‰ä»€ä¹ˆæƒ³èŠçš„å—ï¼Ÿ';
            }
            
            // ç ”ç©¶ç›¸å…³
            else if (lowerMessage.includes('ç ”ç©¶') || lowerMessage.includes('research') || lowerMessage.includes('å­¦æœ¯') ||
                     lowerMessage.includes('å¹²é¢„') || lowerMessage.includes('intervention') || lowerMessage.includes('å¿ƒç†å­¦') ||
                     lowerMessage.includes('psychology') || lowerMessage.includes('ai') || lowerMessage.includes('äººå·¥æ™ºèƒ½')) {
                return 'å¤ªæ£’äº†ï¼æˆ‘å¾ˆå–œæ¬¢è®¨è®ºç ”ç©¶è¯é¢˜ï¼æˆ‘ä¸“æ³¨äºå¹²é¢„ç§‘å­¦ï¼Œç‰¹åˆ«æ˜¯å¦‚ä½•è®¾è®¡AIç³»ç»Ÿæ¥æä¾›é“å¾·å’Œæƒ…å¢ƒæ„ŸçŸ¥çš„å¹²é¢„ã€‚æˆ‘åœ¨æ–¯å¦ç¦HAIå’Œå“¥ä¼¦æ¯”äºšå•†å­¦é™¢å·¥ä½œï¼Œå¯¹æ–‡åŒ–ã€èº«ä»½å’Œå™äº‹å¦‚ä½•å¡‘é€ è¡Œä¸ºç‰¹åˆ«æ„Ÿå…´è¶£ã€‚ä½ æƒ³èŠèŠå“ªä¸ªæ–¹é¢ï¼Ÿ';
            }
            
            
            // è”ç³»ç›¸å…³
            else if (lowerMessage.includes('è”ç³»') || lowerMessage.includes('contact') || lowerMessage.includes('é‚®ç®±')) {
                return 'å¾ˆé«˜å…´ä½ æƒ³è”ç³»æˆ‘ï¼ä½ å¯ä»¥å‘é‚®ä»¶åˆ° xianglutang111@gmail.com æ‰¾æˆ‘èŠå¤©ã€‚æˆ‘å¾ˆä¹æ„è®¨è®ºå¹²é¢„ç§‘å­¦ã€æ–‡åŒ–ç ”ç©¶ã€AIä¼¦ç†ï¼Œæˆ–è€…ä»»ä½•ä½ æ„Ÿå…´è¶£çš„è¯é¢˜ï¼';
            }
            
            // åˆä½œç›¸å…³
            else if (lowerMessage.includes('é¡¹ç›®') || lowerMessage.includes('project') || lowerMessage.includes('åˆä½œ') ||
                     lowerMessage.includes('collaborate') || lowerMessage.includes('collaboration')) {
                return 'å¤ªæ£’äº†ï¼æˆ‘å¾ˆå–œæ¬¢è®¨è®ºåˆä½œæœºä¼šï¼ä½œä¸ºå¹²é¢„ç§‘å­¦çš„ç ”ç©¶è€…ï¼Œæˆ‘å¯¹è·¨å­¦ç§‘åˆä½œç‰¹åˆ«æ„Ÿå…´è¶£ã€‚æ— è®ºæ˜¯ç ”ç©¶é¡¹ç›®ã€å­¦æœ¯äº¤æµï¼Œè¿˜æ˜¯å…³äºAIä¼¦ç†çš„è®¨è®ºï¼Œæˆ‘éƒ½å¾ˆæœ‰å…´è¶£ã€‚å‘é‚®ä»¶åˆ° xianglutang111@gmail.com æˆ‘ä»¬è¯¦èŠï¼';
            }
            
            // å·¥ä½œç›¸å…³
            else if (lowerMessage.includes('å·¥ä½œ') || lowerMessage.includes('job') || lowerMessage.includes('èŒä½') || 
                     lowerMessage.includes('æ‹›è˜') || lowerMessage.includes('hire')) {
                return 'å¾ˆé«˜å…´ä½ å¯¹æˆ‘çš„å·¥ä½œæ„Ÿå…´è¶£ï¼ä½œä¸ºå¹²é¢„ç§‘å­¦çš„ç ”ç©¶è€…ï¼Œæˆ‘åœ¨æ–¯å¦ç¦HAIå’Œå“¥ä¼¦æ¯”äºšå•†å­¦é™¢å·¥ä½œï¼Œä¸“æ³¨äºAIä¼¦ç†å’Œäººç±»èƒ½åŠ¨æ€§ç ”ç©¶ã€‚å¦‚æœä½ æœ‰ç›¸å…³çš„ç ”ç©¶æœºä¼šæˆ–åˆä½œæƒ³æ³•ï¼Œæˆ‘å¾ˆä¹æ„èŠèŠï¼å‘é‚®ä»¶åˆ° xianglutang111@gmail.com å§ï¼';
            }
            
            // é»˜è®¤å›å¤
            else {
                return 'è°¢è°¢ä½ çš„æ¶ˆæ¯ï¼æˆ‘æ˜¯Xianglu TANGï¼Œä¸€ä¸ªçƒ­çˆ±æ¢ç´¢AIå¦‚ä½•æ”¯æŒäººç±»èƒ½åŠ¨æ€§çš„å¿ƒç†å­¦ç ”ç©¶è€…ã€‚è™½ç„¶æˆ‘çš„AIç³»ç»Ÿæš‚æ—¶æœ‰ç‚¹å°é—®é¢˜ï¼Œä½†æˆ‘å¾ˆä¹æ„å’Œä½ ç›´æ¥èŠå¤©ï¼æˆ‘åœ¨æ–¯å¦ç¦HAIå’Œå“¥ä¼¦æ¯”äºšå•†å­¦é™¢ç ”ç©¶å¹²é¢„ç§‘å­¦ï¼Œå¯¹æ–‡åŒ–ã€èº«ä»½å’Œå™äº‹ç‰¹åˆ«æ„Ÿå…´è¶£ã€‚å‘é‚®ä»¶åˆ° xianglutang111@gmail.com æˆ‘ä»¬èŠèŠå§ï¼';
            }
        }

        // å‘é€æ¶ˆæ¯
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            chatInput.value = '';
            sendButton.disabled = true;
            showTypingIndicator();

            try {
                const response = await callNuwaAPI(message);
                hideTypingIndicator();
                addMessage(response, 'ai');
            } catch (error) {
                console.error('Chat error:', error);
                hideTypingIndicator();
                const fallbackResponse = getSmartFallbackResponse(message);
                addMessage(fallbackResponse, 'ai');
            } finally {
                sendButton.disabled = false;
                chatInput.focus();
            }
        }

        // äº‹ä»¶ç›‘å¬
        sendButton.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('âœ… èŠå¤©ç³»ç»Ÿå·²å‡†å¤‡å°±ç»ªï¼', 'success');
            chatInput.focus();
        });
    </script>
</body>
</html>
